<header class="navbar navbar-fixed-top navbar-inverse">
  <div class="navbar-inner">
    <div class="container">
      <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <%= link_to "Fancy Logo Goes Here", root_path, id: "logo" %>
      <nav>
        <div class="nav-collapse collapse">
          <ul class="nav pull-right">
            <li><%= link_to "Home",    root_path %></li>
            <li><%= link_to "Help",    help_path %></li>
            <li><%= link_to "About Us", about_path %></li>
            <% if !signed_in? %>
              <li><%= link_to "Sign Up", new_user_registration_path  %></li>
            <% end %>  
            <% if !signed_in? %>
                <li><%= link_to "Login", new_user_session_path %></li>
              <% else %>
                <li id="fat-menu" class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    My Account <b class="caret"></b>
                  </a>
                  <ul class="dropdown-menu">
                    <% if (can?(:show, Merchant)) %>
                      <li class="dropdown-submenu">
                        <a tabindex="-1" href="#">My Merchants</a>
                        <ul class="dropdown-menu">
                          <li><%= link_to_if(can?(:create, Merchant), "Create A Merchant", new_merchant_path) {} %></li>
                          <li><%= link_to_if((current_user.merchants.any?) && can?(:index, Merchant), "View Merchants (#{current_user.merchants.count})", merchants_path) {} %></li>
                        </ul>
                      </li>
                    <% end %>
                    <% if (can?(:show, Promotion) && current_user.merchants.any?) %>
                      <li class="dropdown-submenu">
                        <a tabindex="-1" href="#">My Promotions</a>
                        <ul class="dropdown-menu">
                          <li><%= link_to_if(can?(:create, Promotion), "Create A Promotion", new_promotion_path) {} %></li>
                          <li><%= link_to_if((Promotion.exists?(merchant_id: current_user.merchants)) && can?(:index, Promotion), "View Promotions (#{Promotion.where(merchant_id: current_user.merchants).count})", promotions_path) {} %></li>
                        </ul>
                      </li>
                    <% end %>
                    <% if (can?(:show, Cause)) %>
                      <li><%= link_to "View My Causes", causes_path %></li>
                    <% end %>
                    <li><%= link_to "See the Good I've Done", "#" %></li>
                    <li class="divider"></li>
                    <li><%= link_to "Settings", edit_user_registration_path(current_user) %></li>
                    <li><%= link_to "Sign out", destroy_user_session_path, :method => :delete %></li>
                  </ul>
                </li>
            <% end %>
            <% if can? :master, :all %>
              <li id="fat-menu" class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  Admin <b class="caret"></b>
                </a>
                <ul class="dropdown-menu">
                  <li class="dropdown-submenu">
                    <a tabindex="-1" href="#">Merchants</a>
                    <ul class="dropdown-menu">
                      <li><%= link_to "Create Merchant", new_merchant_admin_path %></li>
                      <li><%= link_to "View Merchants (#{Merchant.count})", merchants_admin_path %></li>
                    </ul>
                  </li>
                  <li class="dropdown-submenu">
                    <a tabindex="-1" href="#">Promotions</a>
                    <ul class="dropdown-menu">
                      <li><%= link_to "Create Promotion", new_promotion_admin_path %></li>
                      <li><%= link_to "View Promotions (#{Promotion.count})", promotions_admin_path %></li>
                    </ul>
                  </li>
                  <li class="dropdown-submenu">
                    <a tabindex="-1" href="#">Causes</a>
                    <ul class="dropdown-menu">
                      <li><%= link_to "Create Cause", new_cause_path %></li>
                      <li><%= link_to "View Causes (#{Cause.count})", causes_path %></li>
                    </ul>
                  </li>
                  <li class="dropdown-submenu">
                    <a tabindex="-1" href="#">Channels</a>
                    <ul class="dropdown-menu">
                      <li><%= link_to "Create Channel", new_channel_path %></li>
                      <li><%= link_to "View Channels (#{Channel.count})", channels_path %></li>
                    </ul>
                  </li>
                  <li class="dropdown-submenu">
                    <a tabindex="-1" href="#">Roles</a>
                    <ul class="dropdown-menu">
                      <li><%= link_to "Create Role", new_role_path %></li>
                      <li><%= link_to "View Roles (#{Role.count})", roles_path %></li>
                    </ul>
                  </li>
                  <li class="dropdown-submenu">
                    <a tabindex="-1" href="#">Users and Roles</a>
                    <ul class="dropdown-menu">
                      <li><%= link_to "View Users and Roles", users_path %></li>
                    </ul>
                  </li>
                </ul>
              </li>
            <% end %>
          </ul>
        </div>
      </nav>
    </div>
  </div>
</header>
